function [VGlobal, VNodal, VKey] = CCM_Vulnerability(gMatrix)
% CCM_Vulnerability was used to compute the Vulnerability  of networks.
% Input:
%   gMatrix     connect matrix
% Usage:
%   [VGlobal, VNodal, VKey] = CCM_Vulnerability(gMatrix) returns the vulner-
%   -ability of global and each node of graph.VKey is the index of node
%   with the greatest vulnerability.
% Note: 
%   more nodes, more effective!
% Refer:
%   Latora.V.,etc.Vulnerability and protection of infrastructure
%   networks.(2005)
% See also CCM_GEfficiency

% Written by Yong Liu, April,2008
% Center for Computational Medicine (CCM),
% National Laboratory of Pattern Recognition (NLPR),
% Institute of Automation,Chinese Academy of Sciences (IACAS), China.
% E-mail: yliu@nlpr.ia.ac.cn // liuyong.81@gmail.com
% based on Matlab 2006a
% Version (1.0)
% $Revision: 1.0, Copywrite (c) 2008

N       = length(gMatrix);
EGlobal = CCM_GEfficiency(gMatrix);

% Predefine
EG_Node = zeros(N, 1);
sg      = zeros(size(gMatrix)-1);
for i   = 1:N
    res = [1:(i-1), (i+1):N];
    sg  = gMatrix(res, res);
    EG_Node(i) = CCM_GEfficiency(sg);% get the global efficiency without i
end

VNodal  = (EGlobal - EG_Node)/EGlobal;
[VGlobal, VKey] = max(VNodal);% select the greatest Vulnerability value 
                              %and its node index
                             
                             